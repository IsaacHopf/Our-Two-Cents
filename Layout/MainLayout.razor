@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@using System.Globalization

<MudThemeProvider Theme="@_theme" IsDarkMode="@_darkMode"/>
<MudPopoverProvider/>
<MudDialogProvider/>
<MudSnackbarProvider/>

<MudLayout>
    
    <MudDrawer @bind-Open="@_drawerOpen" Color="Color.Primary">
        <MudDrawerHeader>
            <MudIcon Icon="@Icons.Material.Filled.SupervisedUserCircle"/>
            <MudText Typo="Typo.h6">Our Two Cents</MudText>
        </MudDrawerHeader>
        <hr/>
        <NavMenu/>
    </MudDrawer>
    
    <MudAppBar Dense="true" Color="Color.Secondary">
        <MudIconButton OnClick="@ToggleDrawerOpen" Icon="@Icons.Material.Rounded.Menu" Color="Color.Inherit" Edge="Edge.Start"/>
        <MudText Typo="Typo.h6" Class="ms-3">@BuildBreadcrumbTrail()</MudText>
        <MudSpacer/>
        <MudIconButton OnClick="@ToggleDarkMode" Icon="@_darkModeIcon" Color="Color.Inherit" Edge="Edge.End" Size="Size.Small" Class="opacity-50"/>
    </MudAppBar>
    
    <MudMainContent>
        <div class="p-4">
            @Body
        </div>
    </MudMainContent>
    
</MudLayout>

@code 
{
    private bool _drawerOpen = true;

    private void ToggleDrawerOpen()
    {
        _drawerOpen = !_drawerOpen;
    }
    
    private bool _darkMode = false;
    private string _darkModeIcon = Icons.Material.Rounded.DarkMode;

    private void ToggleDarkMode()
    {
        _darkMode = !_darkMode;
        _darkModeIcon = _darkMode
            ? Icons.Material.Rounded.LightMode
            : Icons.Material.Rounded.DarkMode;
    }

    private string BuildBreadcrumbTrail()
    {
        var uri = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        uri = Uri.UnescapeDataString(uri);
        uri = CultureInfo.CurrentCulture.TextInfo.ToTitleCase(uri);
        uri = uri.Replace("/", "  /  ").Replace("-", " ");
        return uri;
    }

    private readonly MudTheme _theme = new()
    {
        PaletteLight = new PaletteLight
        {
            Primary = Colors.Blue.Darken4,
            Secondary = Colors.Blue.Darken3,
            Tertiary = Colors.Blue.Lighten5
        },
        PaletteDark = new PaletteDark
        {
            Primary = Colors.Indigo.Darken4,
            Secondary = Colors.Indigo.Darken3,
            Tertiary = Colors.Indigo.Lighten5,
            Background = Colors.BlueGray.Darken1,
            TextPrimary = Colors.Gray.Lighten4
        }
    };
}